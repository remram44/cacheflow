(function(t){function e(e){for(var o,i,u=e[0],c=e[1],a=e[2],l=0,f=[];l<u.length;l++)i=u[l],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&f.push(s[i][0]),s[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);p&&p(e);while(f.length)f.shift()();return r.push.apply(r,a||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,u=1;u<n.length;u++){var c=n[u];0!==s[c]&&(o=!1)}o&&(r.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},s={app:0},r=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/cacheflow/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=e,u=u.slice();for(var a=0;a<u.length;a++)e(u[a]);var p=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var o=n("85ec"),s=n.n(o);s.a},"1fbe":function(t,e,n){},2564:function(t,e,n){},"54d1":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Canvas",{attrs:{workflow:t.workflow},on:{stepremove:t.removeStep,stepmove:t.moveStep}}),n("Library",{on:{add:t.addStep}})],1)},r=[],i=(n("a4d3"),n("e01a"),n("d28b"),n("fb6a"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"canvas"},t._l(t.workflow.steps,(function(e,o){return n("Step",{key:o,attrs:{step:e,name:o},on:{setport:t.setPort,stepmove:t.moveStep,remove:function(e){return t.removeStep(o)}}})})),1),n("svg",{staticClass:"canvas ports"},t._l(this.ports,(function(e){return n("Port",{key:e.name,attrs:{port:e},on:{startconnection:t.startConnection,grabconnection:t.grabConnection}})})),1),n("svg",{staticClass:"canvas connections"},[t._l(t.connections,(function(t){return n("Connection",{key:t.key,attrs:{source:t.source,dest:t.dest}})})),null!=t.newConnection?n("Connection",{attrs:{source:t.newConnection.source,dest:t.newConnection.dest}}):t._e()],2)])}),u=[],c=(n("99af"),n("a434"),n("4fad"),n("3835")),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"step",style:t.style,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:e.target!==e.currentTarget?null:(e.preventDefault(),t.mousedown(e))}}},[n("a",{staticClass:"close",on:{click:function(e){return e.target!==e.currentTarget?null:(e.preventDefault(),t.remove(e))}}},[t._v("[x]")]),n("h2",[t._v(t._s(t.step.component.type))]),n("table",{staticClass:"outputs"},t._l(t.step.outputs,(function(e){return n("tr",{key:e},[n("td",[t._v("???")]),n("td",[t._v(t._s(e))])])})),0),n("table",{staticClass:"inputs"},t._l(t.inputs,(function(e){return n("tr",{key:e[0]},[n("td",[t._v(t._s(e[0]))]),n("td",[null!==e[1]?n("input",{attrs:{type:"text"},domProps:{value:e[1]},on:{change:function(n){return t.changeInput(e[0],n)}}}):t._e()])])})),0)])},p=[];n("4e82"),n("ac1f"),n("25f0"),n("5319");function l(t,e){t.sort((function(t,n){return e(t)<e(n)?-1:e(t)>e(n)?1:0}))}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)}))}var v={name:"Step",props:["name","step"],computed:{inputs:function(){var t=Object.entries(this.step.inputs);l(t,(function(t){return t[0]}));for(var e=0;e<t.length;++e)0==t[e][1].length?t[e][1]="":"string"!=typeof t[e][1][0]&&(t[e][1]=null);return t},style:function(){return"left: ".concat(this.step.position[0],"px; top: ").concat(this.step.position[1],"px;")}},methods:{sendUpdate:function(){for(var t=this.$el.querySelectorAll(".outputs tr"),e=0;e<t.length;++e){var n=t[e].getBoundingClientRect();this.$emit("setport",{name:"".concat(this.name,".out.").concat(this.step.outputs[e]),type:"output",step:this.name,port_name:this.step.outputs[e],position:[n.right+6,(n.top+n.bottom)/2]})}for(var o=this.$el.querySelectorAll(".inputs tr"),s=0;s<o.length;++s){var r=o[s].getBoundingClientRect();this.$emit("setport",{name:"".concat(this.name,".in.").concat(this.inputs[s][0]),type:"input",step:this.name,port_name:this.inputs[s][0],position:[r.left-6,(r.top+r.bottom)/2]})}},changeInput:function(t,e){console.log("Step ",this.name," input ",t," changed to ",e.target.value)},mousedown:function(t){document.addEventListener("mouseup",this.mouseup),document.addEventListener("mousemove",this.mousemove),this.offset=[this.step.position[0]-t.clientX,this.step.position[1]-t.clientY]},mouseup:function(){document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("mousemove",this.mousemove),this.$emit("stepmove",{name:this.name,position:this.step.position})},mousemove:function(t){t.preventDefault(),this.step.position=[t.clientX+this.offset[0],t.clientY+this.offset[1]]},remove:function(){this.$emit("remove")}},mounted:function(){this.$nextTick(this.sendUpdate)},updated:function(){this.$nextTick(this.sendUpdate)},beforeDestroy:function(){document.removeEventListener("mousemove",this.mousemoved),document.removeEventListener("mouseup",this.mouseup);var t=!0,e=!1,n=void 0;try{for(var o,s=this.step.outputs[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var r=o.value;this.$emit("setport",{name:"".concat(this.name,".out.").concat(r),position:void 0})}}catch(f){e=!0,n=f}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}var i=!0,u=!1,c=void 0;try{for(var a,p=this.inputs[Symbol.iterator]();!(i=(a=p.next()).done);i=!0){var l=a.value;this.$emit("setport",{name:"".concat(this.name,".in.").concat(l[0]),position:void 0})}}catch(f){u=!0,c=f}finally{try{i||null==p.return||p.return()}finally{if(u)throw c}}}},m=v,d=(n("9123"),n("2877")),h=Object(d["a"])(m,a,p,!1,null,"83005308",null),y=h.exports,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("circle",{class:t.port.type,attrs:{cx:t.port.position[0],cy:t.port.position[1]},on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:e.target!==e.currentTarget?null:(e.preventDefault(),t.mousedown(e))}}})},w=[],_={name:"Port",props:["port"],methods:{mousedown:function(){"output"==this.port.type?this.$emit("startconnection",this.port.name):this.$emit("grabconnection",this.port.name)}}},x=_,g=(n("b562"),Object(d["a"])(x,b,w,!1,null,"0219e024",null)),k=g.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("path",{staticClass:"connection",attrs:{d:t.path}})},S=[],$={name:"Connection",props:["source","dest"],computed:{path:function(){var t=Object(c["a"])(this.source,2),e=t[0],n=t[1],o=Object(c["a"])(this.dest,2),s=o[0],r=o[1];return"M ".concat(e," ").concat(n," C ").concat(e+40," ").concat(n," ").concat(s-40," ").concat(r," ").concat(s," ").concat(r)}}},O=$,j=(n("8712"),Object(d["a"])(O,C,S,!1,null,"83056670",null)),L=j.exports,E={name:"Canvas",props:["workflow"],data:function(){return{ports:{},newConnection:null}},computed:{connections:function(){var t={},e={},n={};for(var o in this.workflow.steps){var s=this.workflow.steps[o],r=0;t[o]={};var i=!0,u=!1,a=void 0;try{for(var p,f=s.outputs[Symbol.iterator]();!(i=(p=f.next()).done);i=!0){var v=p.value;t[o][v]=r++}}catch(D){u=!0,a=D}finally{try{i||null==f.return||f.return()}finally{if(u)throw a}}e[o]=r;var m=0;n[o]={};var d=Object.entries(s.inputs);l(d,(function(t){return t[0]}));for(var h=0,y=d;h<y.length;h++){var b=Object(c["a"])(y[h],1),w=b[0];n[o][w]=m++}}var _=[];for(var x in this.workflow.steps){var g=this.workflow.steps[x];for(var k in g.inputs){var C=g.inputs[k],S=!0,$=!1,O=void 0;try{for(var j,L=C[Symbol.iterator]();!(S=(j=L.next()).done);S=!0){var E=j.value;if("string"!=typeof E){var M="".concat(E.step,".out.").concat(E.output);if(!(M in this.ports))continue;var P=this.ports[M].position,T="".concat(x,".in.").concat(k);if(!(T in this.ports))continue;var U=this.ports[T].position;_.push({key:"".concat(M,".").concat(T),source_step:E.step,source_output:E.output,dest_step:x,dest_input:k,source:P,dest:U})}}}catch(D){$=!0,O=D}finally{try{S||null==L.return||L.return()}finally{if($)throw O}}}}return _}},methods:{setPort:function(t){void 0!==t.position?this.$set(this.ports,t.name,t):this.$delete(this.ports,t.name)},moveStep:function(t){this.$emit("stepmove",t)},removeStep:function(t){this.$emit("stepremove",t)},startConnection:function(t){var e=this.ports[t];this.newConnection={key:"".concat(t,"."),source_step:e.step,source_output:e.port_name,source:e.position,dest:[event.clientX,event.clientY]},document.addEventListener("mouseup",this.connectionMouseUp),document.addEventListener("mousemove",this.connectionMouseMove)},grabConnection:function(t){var e=null,n=!0,o=!1,s=void 0;try{for(var r,i=this.connections[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var u=r.value;if("".concat(u.dest_step,".in.").concat(u.dest_input)==t){for(var c=this.workflow.steps[u.dest_step].inputs[u.dest_input],a=0;a<c.length;++a)if("string"!=typeof c[a]&&c[a].step==u.source_step&&c[a].output==u.source_output){c.splice(a,1),console.log("Removed connection");break}e="".concat(u.source_step,".out.").concat(u.source_output);break}}}catch(p){o=!0,s=p}finally{try{n||null==i.return||i.return()}finally{if(o)throw s}}null!==e&&this.startConnection(e)},connectionMouseUp:function(t){document.removeEventListener("mouseup",this.connectionMouseUp),document.removeEventListener("mousemove",this.connectionMouseMove);var e=null,n=150;for(var o in this.ports){var s=this.ports[o];if("input"==s.type){var r=s.position[0]-t.clientX,i=s.position[1]-t.clientY,u=r*r+i*i;u<n&&(n=u,e=s)}}null!==e&&(this.workflow.steps[e.step].inputs[e.port_name]=[{step:this.newConnection.source_step,output:this.newConnection.source_output}],console.log("New connection ","".concat(this.newConnection.source_step,".").concat(this.newConnection.source_output," - ")+"".concat(e.step,".").concat(e.port_name))),this.newConnection=null},connectionMouseMove:function(t){this.newConnection.dest=[t.clientX,t.clientY]}},beforeDestroy:function(){document.removeEventListener("mouseup",this.connectionMouseUp),document.removeEventListener("mousemove",this.connectionMouseMove)},components:{Step:y,Port:k,Connection:L}},M=E,P=(n("dbd4"),Object(d["a"])(M,i,u,!1,null,"0ab8f736",null)),T=P.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"library"},[n("div",[n("div",[n("h1",[t._v("Workflow library")]),t._l(t.components,(function(e){return n("p",{key:e.component.type},[n("button",{on:{click:function(n){return t.add(e)}}},[t._v(t._s(e.name))])])}))],2)])])},D=[],A={name:"Library",data:function(){return{components:[{name:"dataset",component:{type:"dataset"},inputs:["name"],outputs:["table"]},{name:"plot",component:{type:"plot"},inputs:["style","table","x","y"],outputs:["plot"]}]}},methods:{add:function(t){this.$emit("add",t)}}},X=A,Y=(n("ed1d"),Object(d["a"])(X,U,D,!1,null,"2ebac7ce",null)),R=Y.exports,q={name:"App",data:function(){return{workflow:{steps:{dataset:{component:{type:"dataset"},position:[100,100],inputs:{name:["age.csv"]},outputs:["table"]},plot:{component:{type:"plot"},position:[350,150],inputs:{table:[{step:"dataset",output:"table"}],x:["name"],y:["age"],style:[]},outputs:["plot"]}}}}},methods:{addStep:function(t){var e={},n=!0,o=!1,s=void 0;try{for(var r,i=t.inputs[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var u=r.value;e[u]=[]}}catch(a){o=!0,s=a}finally{try{n||null==i.return||i.return()}finally{if(o)throw s}}var c=f();this.$set(this.workflow.steps,c,{component:t.component,position:[10,10],inputs:e,outputs:t.outputs.slice()}),console.log("Step ",c," added")},removeStep:function(t){this.$delete(this.workflow.steps,t),console.log("Step ",t," removed")},moveStep:function(t){var e=t.name,n=t.position;console.log("Step ",e," moved to ",n)}},components:{Canvas:T,Library:R}},B=q,I=(n("034f"),Object(d["a"])(B,s,r,!1,null,null,null)),J=I.exports;o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(J)}}).$mount("#app")},"85ec":function(t,e,n){},8712:function(t,e,n){"use strict";var o=n("2564"),s=n.n(o);s.a},9123:function(t,e,n){"use strict";var o=n("54d1"),s=n.n(o);s.a},"96ef":function(t,e,n){},b562:function(t,e,n){"use strict";var o=n("ea05"),s=n.n(o);s.a},dbd4:function(t,e,n){"use strict";var o=n("1fbe"),s=n.n(o);s.a},ea05:function(t,e,n){},ed1d:function(t,e,n){"use strict";var o=n("96ef"),s=n.n(o);s.a}});
//# sourceMappingURL=app.91f41349.js.map